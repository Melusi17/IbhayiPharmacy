@model IbhayiPharmacy.Models.PharmacistVM.PrescriptionReportVM

<div class="preview-table">
    @if (!Model.Groups.Any())
    {
        <div class="alert alert-info text-center">
            <i class="fas fa-info-circle"></i> No dispensed prescriptions found for the selected date range.
        </div>
    }
    else
    {
        <!-- Dynamic title based on grouping -->
        <div class="report-header mb-4">
            @if (Model.GroupBy == "Doctor")
            {
                <h4 class="text-primary">DISPENSED PRESCRIPTIONS BY DOCTOR</h4>
            }
            else
            {
                <h4 class="text-primary">DISPENSED PRESCRIPTIONS BY MEDICATION</h4>
            }
            <p class="text-muted">@Model.StartDate.ToString("dd/MM/yyyy") – @Model.EndDate.ToString("dd/MM/yyyy")</p>
        </div>

        @foreach (var group in Model.Groups)
        {
            <div class="group-section mb-4">
                <h5 class="group-title">
                    <i class="fas @(Model.GroupBy == "Doctor" ? "fa-user-md" : "fa-pills")"></i>
                    @Model.GroupBy.ToUpper(): @group.GroupName
                </h5>
                <table class="table table-bordered table-striped">
                    <thead class="thead-light">
                        <tr>
                            <th>Date</th>
                            <th>Medication</th>
                            <th>Qty</th>
                            <th>Repeats</th>
                            @if (Model.GroupBy == "Medication")
                            {
                                <th>Doctor</th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in group.Records)
                        {
                            <tr>
                                <td>@item.Date.ToString("yyyy-MM-dd")</td>
                                <td>@item.Medication</td>
                                <td>@item.Quantity</td>
                                <td>@item.Repeats</td>
                                @if (Model.GroupBy == "Medication")
                                {
                                    <td>@item.DoctorName</td>
                                }
                            </tr>
                        }
                    </tbody>
                </table>
                <p class="subtotal"><strong>Sub-total: @group.Subtotal items</strong></p>
            </div>
        }

        <div class="grand-total-section mt-4 pt-3 border-top">
            <h4 class="text-end text-success">GRAND TOTAL: @Model.GrandTotal items</h4>
        </div>
    }
</div>
@model IbhayiPharmacy.Models.PharmacyManagerVM.StockOrderVM

@{
    ViewData["Title"] = "Add Order";
    Layout = "~/Views/Shared/_ManagerLayout.cshtml";
}
<a asp-action="Orders" class="btn btn-sm btn-success">Add Orders</a>
 
    
  
     
<div class="card" style="padding: 2rem;">

    <h5 class="title-underline">Order Details</h5>

    <form asp-action="Orders" method="post" id="orderForm">
        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

        <!-- Supplier Selection -->
        <div class="row mb-3">
            
                <label for="SupplierID" class="form-label"><strong>Supplier</strong></label>
                <select asp-for="StockOrder.SupplierID" class="form-select">
                    <option value="">-- Select Supplier --</option>
                    @foreach (var sup in ViewBag.Suppliers)
                    {
                        <option value="@sup.SupplierID">@sup.SupplierName</option>
                    }
                </select>
                <span asp-validation-for="StockOrder.SupplierID" class="text-danger"></span>
       
        </div>

        

        <div id="medicationContainer">
            <!-- Medication rows will be dynamically added here -->
        </div>

        <!-- Add Medication Button -->
        <div class="mb-3">
            <button type="button" class="btn" id="addMedicationBtn">
                + Add Medication
            </button>
        </div>

        <!-- Form Buttons -->
        <div class="text-center mt-4">
            <button type="submit" class="btn"> Save Order</button>
            <a asp-action="ManageOrders" class="btn" style="background-color: #7f8c8d;">Cancel</a>
        </div>
    </form>
</div>
 

@section Scripts {
    <script>
        let medicationIndex = 0;

        document.getElementById("addMedicationBtn").addEventListener("click", function () {
            const container = document.getElementById("medicationContainer");

            const row = document.createElement("div");
            row.classList.add("row", "mb-3",  "rounded", "p-3");
            row.style.backgroundColor = "#f9f9f9";

            row.innerHTML = `
                <div class="col-md-5">
                    <label class="form-label"><strong>Medication</strong></label>
                    <select name="OrderLines[${medicationIndex}].MedicationID" class="form-select" required>
                        <option value="">-- Select Medication --</option>
                        @foreach (var med in ViewBag.Medications)
                        {
                           <option value="@med.MedcationID">@med.MedicationName</option>
                        }
                    </select>
                </div>

                <div class="col-md-3">
                    <label class="form-label"><strong>Quantity</strong></label>
                    <input name="OrderLines[${medicationIndex}].OrderQuantity" class="form-control" type="number" min="1" required />
                </div>

                <div class="col-md-1 d-flex align-items-end">
                    <button type="button" class="btn" style="background-color: #e74c3c;" title="Remove Row">x</button>
                </div>
            `;

            container.appendChild(row);

            // Remove row handler
            row.querySelector(".btn").addEventListener("click", function () {
                row.remove();
            });

            medicationIndex++;
        });
    </script>
}

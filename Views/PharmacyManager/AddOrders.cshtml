@model IbhayiPharmacy.Models.StockOrder
@{
    ViewData["Title"] = "Medication Orders";
    Layout = "~/Views/Shared/_ManagerLayout.cshtml";
}

<div class="card p-3">
    <h5 class="title-underline">Order Medication</h5>

    <form asp-action="AddOrders" asp-controller="PharmacyManager" method="post">
        <div asp-validation-summary="ModelOnly"></div>

        <!-- Hidden Template for Medication Row -->
        <div id="medicationTemplate" class="d-none">
            <div class="prescription-item border-bottom pb-3 mb-3">
                <div class="row align-items-end g-2">
                    <div class="col-md-2">
                        <label asp-for="MedicationID" class="form-label">Medication</label>
                        <select asp-for="MedicationID" class="form-control">
                            <option selected disabled>Select Medication</option>
                            @foreach (var item in ViewBag.Medications)
                            {
                                <option value="@item.MedicationID">@item.MedicationName</option>
                            }
                        </select>
                        <span asp-validation-for="MedicationID" class="text-danger"></span>

                    </div>

                    <div class="col-md-1">
                        <label asp-for="SupplierID" class="form-label">Supplier</label>
                        <select asp-for="SupplierID" class="form-control" id="dosageForm">
                            <option selected disabled>Select Supplier</option>
                            @foreach (var item in ViewBag.Suppliers)
                            {
                                <option value="@item.SupplierID">@item.SupplierName</option>
                            }
                        </select>
                        <span asp-validation-for="SupplierID" class="text-danger"></span>
                    </div>

                    <div class="col-md-1">
                        <label asp-for="Quantity" class="form-label">Qty</label>
                        <input asp-for="Quantity" type="number" class="form-control" min="1" placeholder="e.g. 14">
                        <span asp-validation-for="Quantity" class="text-danger"></span>
                    </div>

                    <div class="col-md-2">
                        <label asp-for="OrderDate" class="form-label">Date</label>
                        <input asp-for="OrderDate" class="form-control" type="date" />
                        <span asp-validation-for="OrderDate" class="text-danger"></span>
                    </div>



                    @*  <div class="col-md-2">
                    <label class="form-label d-block">Status</label>
                    <span class="badge bg-warning text-dark">Pending</span>
                </div> *@

                    <div class="col-md-1 text-end">

                        <button class=" btn-danger" type="button" onclick="removeMedication(this)">
                            Delete
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="container ">


            <!-- Prescription Items Container (starts empty) -->
            <div id="prescriptionContainer"></div>

            <!-- Action Buttons -->
            <div class="mt-4 d-flex gap-3 flex-wrap">
                <button class="btn btn-success" type="submit">Confirm & Send email</button>

                <button class="btn btn-outline-primary" type="button" onclick="addMedication()">➕ Add Medication</button>
            </div>
        </div>
    </form>
</div>
@section Scripts {
    <script>
        function addMedication() {
            const container = document.getElementById('prescriptionContainer');
            const template = document.getElementById('medicationTemplate').firstElementChild.cloneNode(true);
            container.appendChild(template);
        }

        function removeMedication(button) {
            button.closest('.prescription-item').remove();
        }
    </script>
}
